// SPDX-License-Identifier: MPL-2.0-or-later
= FlatRacoon SDK
:toc: macro
:toclevels: 2

image:https://img.shields.io/badge/Status-Production%20Ready-brightgreen.svg[Status]
image:https://img.shields.io/badge/Completion-100%25-success.svg[Completion]
image:https://img.shields.io/badge/Language-ReScript-red.svg[ReScript]

ReScript/Deno SDK for programmatic access to the FlatRacoon Network Stack orchestrator.

toc::[]

== Overview

The FlatRacoon SDK provides a type-safe, ergonomic interface to the orchestrator API.

**Tech Stack:**

* **Language:** ReScript (compiles to ES6 JavaScript)
* **Runtime:** Deno
* **API:** REST over HTTP

== Installation

[source,bash]
----
deno add @flatracoon/sdk
----

Or use directly:
[source,typescript]
----
import { make, getModules } from "https://deno.land/x/flatracoon/mod.ts"
----

== Usage

=== Basic Example

[source,rescript]
----
let client = FlatRacoonClient.make(~baseUrl="http://localhost:4000")

// Get all modules
let modules = await client->FlatRacoonClient.getModules
switch modules {
| Ok(mods) => Console.log(`Found ${mods->Array.length->Int.toString} modules`)
| Error(e) => Console.error(`Error: ${e}`)
}

// Deploy a module
let result = await client->FlatRacoonClient.deployModule(~name="zerotier-k8s-link")
----

=== JavaScript/TypeScript Usage

Compiled ReScript outputs clean ES6:

[source,typescript]
----
import * as FlatRacoon from "@flatracoon/sdk"

const client = FlatRacoon.make({ baseUrl: "http://localhost:4000" })

// Get health status
const health = await FlatRacoon.getHealth(client)
if (health.TAG === "Ok") {
  console.log(`Healthy: ${health._0.healthyCount}`)
  console.log(`Unhealthy: ${health._0.unhealthyCount}`)
}
----

== API Reference

=== Client Creation

[source,rescript]
----
let make: (~baseUrl: string=?) => client
----

Creates a new FlatRacoon client. Defaults to `http://localhost:4000`.

=== Module Operations

[source,rescript]
----
let getModules: client => promise<result<array<moduleInfo>, string>>
let getModule: (client, ~name: string) => promise<result<moduleInfo, string>>
let deployModule: (client, ~name: string) => promise<result<deploymentResponse, string>>
let restartModule: (client, ~name: string) => promise<result<deploymentResponse, string>>
let stopModule: (client, ~name: string) => promise<result<deploymentResponse, string>>
----

=== Health & Monitoring

[source,rescript]
----
let getHealth: client => promise<result<healthSummary, string>>
let getLogs: (client, ~name: string, ~lines: int=?) => promise<result<logsResponse, string>>
----

=== Deployment

[source,rescript]
----
let deployAll: client => promise<result<deploymentResponse, string>>
let getDeploymentOrder: client => promise<result<array<string>, string>>
----

== Types

=== moduleInfo

[source,rescript]
----
type moduleInfo = {
  name: string,
  status: moduleStatus,
  completion: int,
  layer: string,
  version: string,
}

type moduleStatus = Running | Stopped | Pending | Error
----

=== healthSummary

[source,rescript]
----
type healthSummary = {
  allHealthy: bool,
  healthyCount: int,
  unhealthyCount: int,
  unknownCount: int,
}
----

== Development

[source,bash]
----
# Build ReScript
deno task build

# Watch mode
deno task watch

# Run tests
deno task test

# Format
deno fmt

# Lint
deno lint
----

== Status

**Phase:** ðŸŸ¢ Production Ready
**Completion:** 100%

=== Current State

âœ… Type-safe ReScript client
âœ… Full HTTP API integration
âœ… Result types for error handling
âœ… ES6 module output
âœ… Clean JavaScript/TypeScript interop
âœ… All orchestrator endpoints supported

=== Known Seams (Improvement Opportunities)

See link:../SEAM_ANALYSIS.adoc[SEAM_ANALYSIS.adoc] for comprehensive analysis.

ðŸŸ¡ **Important:**

* **Incomplete JSON parsing** - Currently returns placeholder values (empty arrays, empty strings)
  ** Needs proper `@rescript/core` JSON decoders
  ** Runtime type validation required
  ** Critical for SDK users who depend on actual data

ðŸŸ¢ **Nice-to-have:**

* **TypeScript definitions** - Generate `.d.ts` files for TS users
* **npm package** - Publish to npm registry for broader access

**Priority:** JSON parsing is the top priority for the SDK. Without real parsing,
the SDK returns empty data and is not usable for production workloads.

== License

PMPL-1.0-or-later

== See Also

* link:../orchestrator/[Orchestrator] - Phoenix backend
* link:../tui/[TUI] - Ada terminal interface
* link:../README.adoc[FlatRacoon Stack] - Main documentation
